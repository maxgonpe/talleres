{% extends 'base.html' %}
{% load humanize %}
{% block content %}
<h2>Componente + Acción (precios)</h2>

<div class="d-flex gap-2 mb-2">
  <a href="{% url 'comp_accion_create' %}" class="btn btn-success mt-2">Nuevo precio</a>
  <a href="{% url 'accion_list' %}" class="btn btn-outline-primary mt-2">Gestionar acciones</a>
  <a href="javascript:history.back()" class="btn btn-sm btn-warning mt-2">⬅️ Volver al panel</a>
</div>

<input type="text" id="filterInput" class="form-control my-2" placeholder="Buscar por componente o acción..." value="{{ q|default:'' }}">

<div id="items-container">
  {% for it in items %}
  <div class="card mb-2 item-card">
    <div class="card-body d-flex justify-content-between align-items-center">
      <div>
        <div><strong>{{ it.componente.nombre }}</strong> — {{ it.accion.nombre }}</div>
        <div class="text-muted small">ID: {{ it.id }}</div>
      </div>
      <div class="text-end">
        <div class="fw-bold">${{ it.precio_mano_obra|floatformat:0|intcomma }}</div>
        <div class="mt-1">
          <a href="{% url 'comp_accion_update' it.pk %}" class="btn btn-sm btn-secondary">Editar</a>
          <a href="{% url 'comp_accion_delete' it.pk %}" class="btn btn-sm btn-danger">Eliminar</a>
        </div>
      </div>
    </div>
  </div>
  {% empty %}
  <p class="text-muted">No hay precios configurados.</p>
  {% endfor %}
</div>

<script>
document.getElementById('filterInput')?.addEventListener('keyup', function(){
  const v = this.value.toLowerCase();
  document.querySelectorAll('.item-card').forEach(c=>{
    c.style.display = c.textContent.toLowerCase().includes(v) ? 'block' : 'none';
  });
});
</script>
{% endblock %}
