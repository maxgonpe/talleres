{% extends 'base.html' %}
{% load crispy_forms_tags %}
{% load static %}

{% block extra_css %}
  <link rel="stylesheet" href="{% static 'css/centralized-colors.css' %}">
  <style>
    .container {
      background: var(--bg-card);
      border-radius: var(--border-radius-lg);
      padding: var(--spacing-lg);
      box-shadow: var(--shadow-md);
    }
    
    .card {
      background: var(--bg-card);
      border: 1px solid var(--border-color);
      border-radius: var(--border-radius-lg);
      box-shadow: var(--shadow-sm);
    }
    
    .card-header {
      background: var(--bg-secondary);
      border-bottom: 1px solid var(--border-color);
      color: var(--text-primary);
      font-weight: 600;
    }
    
    .card-body {
      background: var(--bg-card);
      color: var(--text-primary);
    }
    
    .btn {
      border-radius: var(--border-radius-sm);
      font-weight: 500;
      transition: var(--transition);
    }
    
    .btn-primary {
      background: var(--primary-600);
      border-color: var(--primary-600);
    }
    
    .btn-primary:hover {
      background: var(--primary-700);
      border-color: var(--primary-700);
    }
    
    .btn-secondary {
      background: var(--neutral-600);
      border-color: var(--neutral-600);
    }
    
    .btn-secondary:hover {
      background: var(--neutral-700);
      border-color: var(--neutral-700);
    }
    
    .form-control {
      background: var(--bg-card);
      border: 1px solid var(--border-color);
      color: var(--text-primary);
      border-radius: var(--border-radius-sm);
    }
    
    .form-control:focus {
      background: var(--bg-card);
      border-color: var(--primary-600);
      color: var(--text-primary);
      box-shadow: 0 0 0 0.2rem var(--primary-200);
    }
    
    .form-label {
      color: var(--text-primary);
      font-weight: 500;
    }
    
    .text-muted {
      color: var(--text-secondary) !important;
    }
    
    .badge {
      border-radius: var(--border-radius-sm);
    }
    
    .badge.bg-success {
      background: var(--success-600) !important;
    }
    
    .badge.bg-danger {
      background: var(--danger-600) !important;
    }
    
    h2, h5, h6 {
      color: var(--text-primary);
      font-weight: 600;
    }
    
    ul {
      color: var(--text-primary);
    }
    
    hr {
      border-color: var(--border-color);
    }
  </style>
{% endblock %}

{% block content %}
<div class="container py-4">
  <h2>
    {% if object %}
      ‚úèÔ∏è Editar Cliente: {{ object.nombre }}
    {% else %}
      ‚ûï Nuevo Cliente del Taller
    {% endif %}
  </h2>
  
  <div class="row">
    <div class="col-md-8">
      <form method="post" novalidate>
        {% csrf_token %}
        
        <!-- Informaci√≥n b√°sica -->
        <div class="card mb-3">
          <div class="card-header">
            <h5 class="mb-0">üìã Informaci√≥n B√°sica</h5>
          </div>
          <div class="card-body">
            <div class="row">
              <div class="col-md-6">
                {{ form.rut|as_crispy_field }}
              </div>
              <div class="col-md-6">
                {{ form.nombre|as_crispy_field }}
              </div>
            </div>
            <div class="row">
              <div class="col-md-6">
                {{ form.telefono|as_crispy_field }}
              </div>
              <div class="col-md-6">
                {{ form.email|as_crispy_field }}
              </div>
            </div>
            <div class="row">
              <div class="col-12">
                {{ form.direccion|as_crispy_field }}
              </div>
            </div>
            {% if object %}
            <div class="row">
              <div class="col-12">
                {{ form.activo|as_crispy_field }}
              </div>
            </div>
            {% endif %}
          </div>
        </div>

        <!-- Botones de acci√≥n -->
        <div class="d-flex gap-2">
          <button type="submit" class="btn btn-primary">
            {% if object %}üíæ Actualizar Cliente{% else %}‚ûï Crear Cliente{% endif %}
          </button>
          <a href="{% url 'cliente_taller_list' %}" class="btn btn-secondary">‚ùå Cancelar</a>
        </div>
      </form>
    </div>
    
    <!-- Panel de ayuda -->
    <div class="col-md-4">
      <div class="card">
        <div class="card-header">
          <h6 class="mb-0">‚ÑπÔ∏è Informaci√≥n</h6>
        </div>
        <div class="card-body">
          <h6>RUT</h6>
          <p class="small text-secondary">
            El RUT es el identificador √∫nico del cliente. Debe tener el formato: 12345678-9
          </p>
          
          <h6>Campos obligatorios</h6>
          <ul class="small">
            <li>RUT (√∫nico)</li>
            <li>Nombre</li>
          </ul>
          
          <h6>Campos opcionales</h6>
          <ul class="small">
            <li>Tel√©fono</li>
            <li>Email</li>
            <li>Direcci√≥n</li>
          </ul>
          
          {% if object %}
          <hr>
          <h6>Informaci√≥n del cliente</h6>
          <p class="small">
            <strong>Registrado:</strong> {{ object.fecha_registro|date:"d/m/Y H:i" }}<br>
            <strong>Estado:</strong> 
            {% if object.activo %}
              <span class="badge bg-success text-inverse">Activo</span>
            {% else %}
              <span class="badge bg-danger text-inverse">Inactivo</span>
            {% endif %}
          </p>
          {% endif %}
        </div>
      </div>
    </div>
  </div>
</div>

<script>
// Validaci√≥n de RUT en tiempo real
document.addEventListener('DOMContentLoaded', function() {
    const rutInput = document.querySelector('#id_rut');
    if (rutInput) {
        rutInput.addEventListener('input', function(e) {
            let value = e.target.value.replace(/[^0-9kK]/g, '');
            if (value.length > 1) {
                value = value.slice(0, -1) + '-' + value.slice(-1);
            }
            e.target.value = value;
        });
    }
});
</script>
{% endblock %}
