{% extends 'base.html' %}
{% load humanize %}
{% block content %}

<style>
/* ðŸŽ¨ Mejorar contraste del texto de componentes en diagnÃ³sticos */
.diagnostico-card .list-group-item strong {
    color: #1a252f !important; /* Texto muy oscuro para componentes */
}

.diagnostico-card .list-group-item {
    color: #2c3e50 !important; /* Texto oscuro para descripciones */
}

/* EspecÃ­fico para temas claros */
.theme-cyan .diagnostico-card .list-group-item strong {
    color: #00251a !important; /* Verde muy oscuro para cyan */
}

.theme-sand .diagnostico-card .list-group-item strong {
    color: #1c0e0a !important; /* MarrÃ³n muy oscuro para sand */
}

.theme-sage .diagnostico-card .list-group-item strong {
    color: #0d3a0f !important; /* Verde muy oscuro para sage */
}

.theme-sky .diagnostico-card .list-group-item strong {
    color: #051f4a !important; /* Azul muy oscuro para sky */
}
</style>
<h2>Diagnosticos</h2>

<a href="" class="btn  btn-success mb-3">Descargar Excel</a>
    <a href="" class="btn btn-danger mb-3">Descargar PDF</a>


<input type="text" id="filterInput" class="form-control my-2" placeholder="Buscar por vehiculo, cliente, telefono, diagnostico, partes...">

{% for diagnostico in diagnosticos %}
<div class="card mb-2 diagnostico-card">
    <div class="card-body">
        <strong>Vehiculo:</strong> {{ diagnostico.vehiculo }}<br>
        <strong>Cliente:</strong> {{ diagnostico.vehiculo.cliente.nombre }}<br>
        <strong>Telefono:</strong> {{ diagnostico.vehiculo.cliente.telefono }}<br>
        <strong>Diagnostico:</strong> {{ diagnostico.descripcion_problema }}<br>
        <strong>Partes Afectadas:</strong> 
            {% for comp in diagnostico.componentes.all %}
                {{ comp.nombre }}{% if not forloop.last %}, {% endif %}
            {% empty %}
                Ninguno
            {% endfor %}
            <br>
        <!-- ==== Acciones y Mano de Obra ==== -->
<strong>Acciones realizadas:</strong><br>
{% with diagnostico.acciones_componentes.all as acciones %}
    {% if acciones %}
        <ul class="list-group list-group-flush my-2">
            {% for dca in acciones %}
                <li class="list-group-item d-flex justify-content-between align-items-center">
                    <span>
                        <strong>{{ dca.componente.nombre }}</strong> â€” {{ dca.accion.nombre }}
                    </span>
                    <span class="badge bg-primary rounded-pill">
                        ${{ dca.precio_mano_obra|floatformat:0|intcomma }}
                    </span>
                </li>
            {% endfor %}
        </ul>
        <div class="text-end fw-bold">
            Total mano de obra: 
            ${{ diagnostico.total_mano_obra|default:0|floatformat:0|intcomma }}
        </div>
    {% else %}
        <span class="text-muted">No se registraron acciones</span>
    {% endif %}
{% endwith %}

            

                <strong>Ultima Visita:</strong> {{ diagnostico.fecha }}<br>

        <a href="" class="btn btn-sm btn-secondary mt-2">Editar</a>
        <a href="{% url 'eliminar_diagnostico' diagnostico.pk %}" class="btn btn-sm btn-danger mt-2">Eliminar</a>
        <a href="{% url 'panel_principal' %}" class="btn btn-sm btn-warning">Regresar</a>
    </div>
</div>
{% empty %}
<p>No hay productos registrados.</p>
{% endfor %}

<a href="" class="btn btn-sm btn-warning">Regresar</a>

<script>
document.addEventListener('DOMContentLoaded', function () {
    const filterInput = document.getElementById('filterInput');
    const cards = document.querySelectorAll('.card');

    filterInput.addEventListener('keyup', function () {
        const filterValue = filterInput.value.toLowerCase();

        cards.forEach(function (card) {
            const text = card.textContent.toLowerCase();
            if (text.includes(filterValue)) {
                card.style.display = 'block';
            } else {
                card.style.display = 'none';
            }
        });
    });
});
</script>
{% endblock %}
