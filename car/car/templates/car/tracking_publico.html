{% extends 'base.html' %}
{% load static %}

{% block title %}Seguimiento de VehÃ­culo{% endblock %}

{% block content %}
<div class="container py-4">
  <div class="row justify-content-center">
    <div class="col-md-8 col-lg-7">
      <div class="card border-0 shadow-sm mb-3" style="background: linear-gradient(135deg, rgba(255,241,230,.8), rgba(255,231,208,.8));">
        <div class="card-body">
          <div class="row g-3 align-items-center">
            <div class="col-12 col-md-6">
              <h5 class="mb-1">ðŸ”Ž Seguimiento rÃ¡pido</h5>
              <small class="text-muted">Ingresa tu placa para ver el estado del trabajo</small>
            </div>
            <div class="col-8 col-md-4">
              <input type="text" id="placa-input" class="form-control" placeholder="Ej: JGCX79" value="{{ placa|default:'' }}">
            </div>
            <div class="col-4 col-md-2 d-grid">
              <button id="btn-buscar" class="btn btn-primary">Buscar</button>
            </div>
          </div>
        </div>
      </div>

      <div id="resultado-tracking">
        {% include 'car/_tracking_card.html' with trabajo=trabajo %}
      </div>
    </div>
  </div>
</div>

<script>
document.addEventListener('DOMContentLoaded', function(){
  const input = document.getElementById('placa-input');
  const btn = document.getElementById('btn-buscar');
  const out = document.getElementById('resultado-tracking');
  function buscar(){
    const placa = (input.value||'').trim().toUpperCase();
    if(!placa){ return; }
    fetch(`{% url 'tracking_publico_preview' %}?placa=${encodeURIComponent(placa)}`)
      .then(r=>r.json()).then(({html})=>{ out.innerHTML = html; })
      .catch(()=>{ out.innerHTML = '<div class="alert alert-danger">Error buscando la placa.</div>'; });
  }
  btn.addEventListener('click', buscar);
  input.addEventListener('keydown', e=>{ if(e.key==='Enter'){ buscar(); }});
});
</script>
{% endblock %}